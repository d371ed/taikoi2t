# 仕様

```
usage: taikoi2t [-h] -d DICTIONARY [--opponent] [-v] files [files ...]

positional arguments:
  files                 target images

options:
  -h, --help            show this help message and exit
  -d, --dictionary DICTIONARY
                        student dictionary (CSV)
  --opponent            include the name of opponent
  --csv                 change output to CSV (default: TSV)
  -v, --verbose         print messages and show images for debug (default: silent, -v: error, -vv: print, -vvv: image)
```


## コマンドライン引数

### `-d, --dictionary`

必須.
生徒名と別名を記述した辞書ファイルを指定.

詳しくは [生徒名辞書](#生徒名辞書) をご覧ください.


### `--opponent`

任意.
指定すると対戦相手 (右側) の名前を検出し, 右側チームの前の列に挿入.

小書き文字 (っ, ゃ, ぃ 等) や濁音/半濁音 (が, ぱ 等), 日本語外の漢字は検出精度が低い傾向にあります.


### `--csv`

任意.
指定すると出力形式を CSV へ変更.

TSV と同様ヘッダ行はありません.


### `-v, --verbose`

任意.
デバッグ用の出力モードへ切り替え.


#### デフォルト (指定なし)

Silent. 通常の解析結果を返すモード.

致命的なエラーを除き stderr へも出力を行いません.

画像単位でエラーがあった場合, 実行を継続しつつ stdout へ文字列部分がすべて `Error` の行を出力します.


#### `-v` または `--verbose`

Error. エラーと警告を stderr へ出力するモード.

画像単位でエラーがあった場合に実行は継続されますが, stderr へエラーを出力します. Silent 時と同様に stdout へのエラー行出力もおこなわれます.


#### `-vv`

Print. stdout へデバッグ用の情報を詳細に出力するモード.

結果の出力形式は TSV / CSV ではなくなります.


#### `-vvv`

Image. Print の内容に加え `cv2.imshow` で画像解析の途中経過を表示するモード.


### `-h, --help`

上記ヘルプを表示.


### `files`

1つ以上必須.
解析対象となる画像のパスを指定. ワイルドカードには非対応.

複数渡された場合, 左から順に解析し結果を1画像あたり1行ずつ出力します.
何らかのエラーで抽出が失敗した場合, 文字列部分がすべて `Error` の行が出力されます.


## 出力

以下の形式で出力されます. (区切り文字はスペースに置換してありますが実際はタブ文字 `\t` か `,` です.)

```
勝敗 L1 L2 L3 L4 LSP1 LSP2 (対戦相手) R1 R2 R3 R4 RSP1 RSP2
```

1行が1つの画像に対応します. 出力順は入力順と同じです.

抽出に失敗した場合は以下のようなエラー行が出力されます.

```
FALSE Error Error Error Error Error Error Error Error Error Error Error Error Error
```


### 勝敗

`TRUE` or `FALSE`.
左側のチームが勝利の場合 `TRUE`. 解析にエラーのあった行の場合は `FALSE`.


### L1 ～ L4

`str`.
左側のチームのストライカー生徒名 (略称). 攻撃のログなら A1 ～ A4, 防御のログなら D1 ～ D4.

何らかのエラーがあり抽出に失敗した場合は `Error`. (他の文字列のカラムも同じです.)


### LSP1, LSP2

`str`.
左側のチームのスペシャル生徒名 (略称).

与えた辞書ファイルの順に左右が調整されます.


### (対戦相手)

`str`. (`--opponent` オプション指定時のみ.)
対戦相手 (右側のチーム) の先生名.


### R1 ～ R4

`str`.
右側のチームのストライカー生徒名 (略称). 攻撃のログなら D1 ～ D4, 防御のログなら A1 ～ A4.


### RSP1, RSP2

`str`.
右側のチームのスペシャル生徒名 (略称).

与えた辞書ファイルの順に左右が調整されます.


## 生徒名辞書

`-d, --dictionary` に与える生徒名辞書を [`students.csv`](./students.csv) として同梱しています.

ヘッダ行を含まない CSV で, `ゲーム中の生徒名表記,出力時変換したい略称` の2列で記述されている必要があります.

```csv
シロコ（水着）,水シロコ
アイリ,
アイリ（バンド）,バアイリ
アオバ,
...
```

略称が不要な場合は, 空文字列にすることでそのままの生徒名を出力します.

また, **並び順はスペシャル生徒のソートに利用** するため, 優先して左側に配置したい生徒はより先に記述してください.
(上の例では `シロコ（水着）` を常に左のデータへ正規化するため最初の行に記述しています.)

新たに生徒が追加された場合にはこのファイルに追加する必要があります.
精度向上のため, **この辞書に無い生徒名は検出が不可能** です.

(`students.csv` はスクレイピングにより自動生成していますが, 現在 Google スプレッドシートによって実装されているため同梱していません.)
